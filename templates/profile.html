{% extends "base.html" %}
{% block content %}
<div class="profile-header">
  {% if profile_user[3] %}
    <img src="{{ url_for('static', filename='uploads/' + profile_user[3]) }}"
         alt="Profile Picture" width="120" height="120" style="border-radius:50%;">
  {% endif %}
  <div>
    <h2>{{ profile_user[1] }}</h2>
    <p><strong>Bio:</strong> {{ profile_user[2] or "No bio yet." }}</p>
    <p>
      <strong>Followers:</strong> {{ followers_count }} |
      <strong>Following:</strong> {{ following_count }}
    </p>

    {% if current_user.is_authenticated %}
      {% if current_user.username == profile_user[1] %}
        <a href="{{ url_for('edit_profile') }}">Edit Profile</a>
        <a href="{{ url_for('create_post') }}">New Post</a>
      {% elif current_user.id != profile_user[0] %}
        <form method="post" action="{% if is_following %}{{ url_for('unfollow', user_id=profile_user[0]) }}{% else %}{{ url_for('follow', user_id=profile_user[0]) }}{% endif %}" style="display:inline;">
          <button type="submit">{% if is_following %}Unfollow{% else %}Follow{% endif %}</button>
        </form>
      {% endif %}
    {% endif %}
  </div>
</div>

<hr>

<h3>Posts</h3>
{% for post in posts %}
  <div class="post" style="border:1px solid #ccc; padding:10px; margin:10px 0;">
    <p>
      <em>{{ post[3] }}</em>
    </p>
    <p>{{ post[1] }}</p>
    {% if post[2] %}
      <img src="{{ url_for('static', filename='uploads/' + post[2]) }}" width="200">
    {% endif %}

    {% if current_user.is_authenticated and current_user.username == profile_user[1] %}
      <a href="{{ url_for('edit_post', post_id=post[0]) }}">Edit</a>
      <form action="{{ url_for('delete_post', post_id=post[0]) }}" method="post" style="display:inline;">
        <button type="submit">Delete</button>
      </form>
    {% endif %}
  </div>
{% else %}
  <p>No posts yet.</p>
{% endfor %}
{% endblock %}
